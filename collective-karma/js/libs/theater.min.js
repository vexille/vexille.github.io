!function(e,t){function r(e){var t=this,r={autoplay:!0,erase:!0,locale:"detect"};t.options=t.utils.merge(r,e||{}),"detect"===t.options.locale&&(t.options.locale=(window.navigator.languages||["en"])[0].split("-")[0]),t.keyboards[t.options.locale]||(t.options.locale="en"),t.utils.keyboard=t.keyboards[t.options.locale],t.events={},t.scene=-1,t.scenario=[],t.casting={},t.current={},t.state="ready"}r.prototype={constructor:r,version:"1.1.0",keyboards:{},set:function(e,t){var r=this;switch(r.current.model=e,r.current.type){case"function":r.current.voice.apply(r,t);break;default:r.current.voice.innerHTML=e}return r},getSayingSpeed:function(e,t){"number"!=typeof e&&(t=e,e=0);var r=this,n=r.current.speed+e;n>1&&(n=1);var a=t?n:r.utils.randomFloat(n,1);return r.utils.getPercentageBetween(1e3,50,a)},isMistaking:function(){var e=this;return e.utils.randomFloat(0,1)>e.current.accuracy},utils:{keyboard:{},isNumber:function(e){return"number"==typeof e},isObject:function(e){return e instanceof Object},mapKeyboard:function(e){for(var t,r={},n=0,a=e.length;a>n;n++){t=e[n];for(var i=0,o=t.length;o>i;i++)r[t[i]]={x:i,y:n}}return r},merge:function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);return e},getPercentageBetween:function(e,t,r){return e-e*r+t*r},randomCharNear:function(e){var t=this,r=t.mapKeyboard(t.keyboard),n=1,a=[],i=!!e.match(/[A-Z]/);e=e.toLowerCase();var o,s,c=r[e]||[];for(o in r)r.hasOwnProperty(o)&&o!==e&&(s=r[o],Math.abs(c.x-s.x)<=n&&Math.abs(c.y-s.y)<=n&&a.push(o));var u=a.length>0?a[t.randomNumber(0,a.length-1)]:t.randomChar();return i?u.toUpperCase():u},randomChar:function(){var e=this,t=e.keyboard.join("");return t.charAt(e.randomNumber(0,t.length-1))},randomNumber:function(e,t){return Math.floor(Math.random()*(t-e+1))+e},randomFloat:function(e,t){return Math.round(10*(Math.random()*(t-e)+e))/10},hasClass:function(e,t){return e.classList?e.classList.contains(t):new RegExp("(^| )"+t+"( |$)","gi").test(e.className)},addClass:function(e,t){e.classList?e.classList.add(t):e.className+=" "+t},removeClass:function(e,t){e.classList?e.classList.remove(t):e.className=e.className.replace(new RegExp("(^|\\b)"+t.split(" ").join("|")+"(\\b|$)","gi")," ")}},train:function(e){var t=this,r={experience:.6,voice:function(e){console.log(e)},type:"function",model:""};return e=t.utils.merge(r,e),t.utils.isNumber(e.speed)||(e.speed=e.experience),t.utils.isNumber(e.accuracy)||(e.accuracy=e.experience),t.utils.isNumber(e.invincibility)||(e.invincibility=10*e.accuracy),e},describe:function(e,r,n){if("string"!=typeof e)throw"actor's name has wrong type: "+typeof e;var a=this,i={name:e};return a.utils.isNumber(r)?i.experience=r:a.utils.isObject(r)&&(i=a.utils.merge(i,r)),void 0!==n&&(i.type="function"==typeof n?"function":"DOM",i.voice="DOM"===i.type&&"string"==typeof n?t.querySelector(n):n),a.casting[e]=a.train(i),a},write:function(){for(var e,t=this,r=Array.prototype.splice.apply(arguments,[0]),n=0,a=r.length;a>n;n++)if(e=r[n],"string"==typeof e){var i=e.split(":"),o=i.length>1&"\\"!==i[0].charAt(i[0].length-1),s=o?i.shift().trim():null,c=i.join(":").replace(/\\:/g,":");o&&t.write({name:"actor",args:[s]}),t.options.erase&&o&&t.write({name:"erase"}),t.write({name:"say",args:[c,!o]})}else"number"==typeof e?t.write(0>e?{name:"erase",args:[e]}:{name:"wait",args:[e]}):"function"==typeof e?t.write({name:"call",args:[e]}):e instanceof Object&&t.scenario.push(e);return t.options.autoplay&&t.play(),t},play:function(e){var t=this;return e===!0&&(t.scene=-1),"ready"===t.state&&t.next(),t},on:function(e,t){var r=this;e=e.split(",");for(var n,a=0,i=e.length;i>a;a++)n=e[a]=e[a].trim(),(r.events[n]||(r.events[n]=[])).push(t);return r},emit:function(e,t,r){if("string"!=typeof e)throw"emit: scope missing";"string"!=typeof t?t=void 0:void 0!==t&&void 0===r&&(r=t);var n=this,a=e+(t?":"+t:"");return n.trigger(a,r).trigger("*",[a].concat(r)),n},trigger:function(e,t){var r=this,n=r.events[e]||[];t instanceof Array||(t=[t]);for(var a=0,i=n.length;i>a;a++)n[a].apply(r,[e].concat(t));return r},call:function(e,t){var r=this;return e.apply(r),t?r:r.next()},next:function(){var e=this,t=e.scenario[e.scene];if(t&&e.emit(t.name,"end",[t.name].concat(t.args)),e.scene+1>=e.scenario.length)e.state="ready";else{e.state="playing";var r=e.scenario[++e.scene];e.emit(r.name,"start",[r.name].concat(r.args)),e[r.name].apply(e,r.args)}return e},actor:function(e){var t=this;return t.current=t.casting[e],t.next()},say:function(e,t){var r,n,a=this,i=!1,o=a.current.invincibility;t?(n=a.current.model,r=a.current.model.length-1,e=n+e):(n=a.current.model="",r=-1);var s=setTimeout(function c(){var t,u,l=n.charAt(r);i?(o=a.current.invincibility,i=!1,t=null,u=n=n.substr(0,r),r--):(r++,t=e.charAt(r),--o<0&&(l!==t||a.current.accuracy<=.3)&&a.isMistaking()&&(t=a.utils.randomCharNear(t)),t!==e.charAt(r)&&(i=!0),u=n+=t),a.set(u,[u,t,l,e]),i||r<e.length?s=setTimeout(c,a.getSayingSpeed()):a.next()},a.getSayingSpeed());return a},erase:function(e){var t=this,r="string"==typeof t.current.model?t.current.model.length:-1,n="number"==typeof e&&0>e?r+1+e:0;if(0>r)return t.next();setTimeout(function a(){var e=t.current.model.charAt(r),i=t.current.model.substr(0,--r);t.set(i,[i,null,e,i]),r>=n?setTimeout(a,t.getSayingSpeed(.2,!0)):t.next()},t.getSayingSpeed(.2,!0));return t},wait:function(e){var t=this;return setTimeout(function(){t.next()},e),t}},r.prototype.keyboards.en=["qwertyuiop","asdfghjkl","zxcvbnm"],r.prototype.keyboards.fr=["azertyuiop","qsdfghjklm","wxcvbn"],e.TheaterJS=r}(window,document);